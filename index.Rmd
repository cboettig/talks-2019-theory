---
author: "Carl Boettiger"
institute: "UC Berkeley"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: ["default", "solarized-light.css"]
    lib_dir: libs
    seal: false
    nature:
      highlightStyle: "solarized-light"
      highlightLines: true
      countIncrementalSlides: false
      slideNumberFormat: "%current%"
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(#dev.args=list(bg="transparent"), 
                      echo = FALSE, 
                      message=FALSE, 
                      warning=FALSE,
                      fig.width=10,
                      fig.height = 5,
                      cache = 1)

library(tidyverse)
library(ggthemes)
library(magick)
theme_set(theme_solarized(base_size=26))
scale_colour_discrete <- function(...) scale_colour_solarized()
scale_fill_discrete <- function(...) scale_fill_solarized()
pal <- solarized_pal()(3)

txtcolor <- "#586e75"
```

layout: true
background-color: #fdf6e3
class: center, top

---

# Theory of uncertainty, ecological variation, and the limits of prediction


<div class="my-footer">

<a href="https://carlboettiger.info"> `r icon::fa("user")` Carl Boettiger</a> | 
<a href="https://berkeley.edu"> `r icon::fa("briefcase")` UC Berkeley</a> | 
<a href="https://twitter.com/cboettig"> `r icon::fa("twitter")` @cboettig</a>

</div>

---
layout: false
background-image: url(../image-library/royalsociety/pensive-polarbear.jpg)
background-position: center
background-size: 130%
class: center, top

# Roles of Uncertainty in Ecological Theory

## Noise the Nusiance

## Noise as Creator

## Noise as Informer

---
layout: true
background-color: #fdf6e3
class: center, top

---

# Sources of Uncertainty

## Stochasticity

- demographic
- environmental 
- individual heterogeneity

## Measurement uncertainty

## Model uncertainty

- parameter uncertainty
- structural uncertainty

---

# What is noise?

- "Inherently stochastic"

-- 

- _statistical mechanics_ sense and not the _quantum mechanics_ sense


---

# Uncertainty summarizes complexity

--- 

# The canonical model


\begin{equation}
\textrm{d} N_t = \underbrace{f(N_t) \textrm{d} t}_{\textrm{det skeleton}} + \underbrace{\sigma_d \sqrt{N_t} \phantom{\cdot}\textrm{d}B_t^{(d)} }_{\textrm{demographic noise}} + \underbrace{\sigma_e N_t \phantom{\cdot}\textrm{d}B_t^{(e)}}_{\textrm{environmental noise}} 
\label{canonical}
\end{equation}

---

# Master equation expansion

![](img/markov.png)

## Levins model


\begin{align}
b_n =& c n \left(1 - \frac{n}{N}\right) \\
d_n =& e_t n
\end{align}

---

## Levins model


$$n = x N + \xi N^{1/2}$$


\begin{align}
\frac{\mathrm{d} x}{\mathrm{d} t} =& \underbrace{ c x \left(1 - x\right) }_{\textrm{ birth rate}} - \underbrace{e n}_{\textrm{ death rate}} \\
\frac{\mathrm{d} \xi}{\mathrm{d} t} = 
\end{align}


---


\begin{align}
\frac{\mathrm{d} n}{\mathrm{d} t} = \underbrace{ c n \left(1 - \frac{n}{N}\right) }_{b_n, \textrm{ birth rate}} - \underbrace{e n}_{d_n, \textrm{ death rate}} \label{levins}
\end{align}



---


\begin{align}
\frac{\mathrm{d} x }{\mathrm{d} t}  &= b(x) - d(x) + \mathcal{O}(N^{-1})\\
\frac{\mathrm{d} \sigma^2 }{\mathrm{d} t}  &= 2 \partial_x  \left[ b(x)  - d(x) \right] \sigma^2 + b(x) + d(x)  + \mathcal{O}(N^{-\tfrac{1}{2}}) \label{vanKampen}
\end{align}

---

# Scaling in Demographic vs Environmental noise

```{r}
read_csv("data/gillespie.csv", col_types = "cdiddd")  %>% 
  mutate(system_size = recode(system_size, large = "A. 1000 total sites", small= "B. 100 total sites")) %>%
  ggplot(aes(x = time)) + 
  geom_hline(aes(yintercept = mean), lty=2, col=pal[2]) + 
  geom_hline(aes(yintercept = minus_sd), lty=2, col=pal[2]) + 
  geom_hline(aes(yintercept = plus_sd), lty=2, col=pal[2]) + 
  geom_line(aes(y = n), col=pal[1]) +
  facet_wrap(~system_size, scales = "free_y")
```

---

# Scaling in Demographic vs Environmental noise


---

# Stochastic Phenomena

- Persistence / co-existence
- Stochastic resonance & quasi-cycles
- Stochastic switching

---

# Stochastic Phenomena: Quasi-cycles

```{r }
read_csv("data/quasicycles.csv") %>%
  gather(species, population, -t, -sigma) %>%
  mutate(sigma = as.factor(sigma)) %>%
  mutate(sigma = recode(sigma, "1e-05" = "A.", "0.01" = "B.")) %>%
  rename(time = t) %>%
  ggplot(aes(time, population, col = species)) +
  geom_line() + 
  facet_wrap(~ sigma, ncol=2) + 
  scale_color_solarized() +
  theme(legend.position = "none")
```


---

# Stochastic Phenomena: Quasi-cycles
```{r}
img <- image_read("img/resonance-bjornstad2004.png") %>% image_transparent("white")

ggplot() + 
  annotation_raster(img, 
                    xmin=-Inf, xmax=Inf, ymin=-Inf, ymax=Inf) + 
  labs(title="Bluefin tuna stocks, Bjornstad et al. 2004")

```

---

# Stochastic Phenomena: Noisy switch


$$X_{t+1} = X_t + \underbrace{X_t r \left(1 -\frac{X_t}{K} \right)}_{\textrm{ growth, } g(X_t)}  - \underbrace{\frac{a X_t ^ Q}{X_t^ Q + H ^ Q}}_{\textrm{consumption, } c(X_t)} + \xi_t,$$

---

# Stochastic Phenomena: Noisy switch


```{r noisy_switch, fig.width=7, fig.height=7, fig.cap="Panel A: Data on prevelance of rubella in Copenhagen illustrating potential stochastic switching dynamics between two regimes, reproduced from @Keeling2001. B-D. Stochastic switiching in May's model of alternative stable state dynamics. Panel B: timeseries showning stochastic switching events between regimes. Panel C: separate nonlinear birth and death processes intersect at multiple points creating alternate stable states. Panel D: The corresponding potential well derived from the birth-death model: $U(x) = -\\int b(x) - d(x) \\ud x$. Parameter values shown r = .5, K = 2, Q = 5, H = .38, sigma = .04, a = 0.245, N = 10000, see code in Appendix A. \\label{noisy_switch}"}

p <- list(r = .5, K = 2, Q = 5, H = .38, sigma = .04, a = 0.245, N = 1e4)
theory <- 
  tibble(x= seq(0,2, length.out = 100)) %>%
  mutate(growth = x * p$r * (1 - x / p$K), 
         consumption = p$a * x ^ p$Q / (x^p$Q + p$H^p$Q)) %>%
  mutate(potential = - cumsum(growth - consumption)) %>%
  gather(curve, y, -x, -potential) 
```


```{r}
img <- image_read("img/switching-keeling2001.png") %>% image_transparent("white")
ggplot() + 
  annotation_raster(img, 
                    xmin=-Inf, xmax=Inf, ymin=-Inf, ymax=Inf)
```

Data on prevelance of rubella in Copenhagen illustrating potential stochastic 
switching dynamics between two regimes, reproduced from Keeling et al 2001

---

# Stochastic Phenomena: Noisy switch


```{r}
read_csv("data/noisy_switch.csv")  %>%
  ggplot(aes(t,x)) + 
  geom_line(col = pal[[1]]) 
```


---

# Stochastic Phenomena: Noisy switch



```{r}
theory %>%
  ggplot(aes(x, y, col=curve)) +
  geom_line(lwd = 2) + 
  labs(x = bquote(X[t]), y = bquote(X[t+1])) 
```


---

# Stochastic Phenomena: Noisy switch


```{r}
theory %>%
  ggplot(aes(x, potential)) + 
  geom_line(col=pal[1], lwd=2) + 
  coord_cartesian(xlim=c(0,1.6), ylim=c(-1.15,-0.9))

```



---

# Knowledge from Noise?

---


# Knowledge from Noise?

## Early Warning Signals


```{r}
img <- image_read("img/pop-dai2015.png") %>% image_transparent("white")
ggplot() + 
  annotation_raster(img, 
                    xmin=-Inf, xmax=Inf, ymin=-Inf, ymax=Inf)
```

```{r}
img <- image_read("img/cv-dai2015.png") %>%
  image_transparent("white")

ggplot() + 
  annotation_raster(img, 
                    xmin=-Inf, xmax=Inf, ymin=-Inf, ymax=Inf)
```

```{r}
tipping <- read_csv("data/tipping.csv") 
scientific <- function(l) {
    if(max(l, na.rm=TRUE) < 1e3) return(l)
     l <- format(l, scientific = TRUE)
     l <- gsub("^(.*)e", "'\\1'e", l)
     l <- gsub("e", "%*%10^", l)
     l <- gsub("^'1'%\\*%", "", l)
     l <- gsub("\\+", "", l)
     parse(text=l)
}
tipping %>% 
  select(t, population = x, tip_time) %>%
  ggplot(aes(t, population)) +
  geom_line(lwd = 1, col = pal[1]) + 
  geom_vline(aes(xintercept = tip_time), lwd = 1, col = pal[2], lty=2) + 
  scale_y_log10(labels=scientific)  + 
  coord_cartesian(ylim=c(1e3, 5e5)) +
  labs(subtitle = "Yeast population size", 
       caption = "Vertical red dashed line indicates tipping point location")
```

```{r}
tipping %>%
  dplyr::select(-x) %>%
  dplyr::rename("autocorrelation" = autocorrelation, "variance" = variance) %>%
  gather(series, value, -t, -tip_time) %>%
  ggplot(aes(t, value)) + 
  geom_line(lwd = 1, col = pal[[1]]) + 
  geom_vline(aes(xintercept = tip_time), lwd = 1, col = pal[[2]], lty=2) +
  facet_wrap(~series, ncol = 2, scales="free_y") 
```


---


# Knowledge from Noise?

## Noise partitioning, mechanism, and transients


---

# Limits to Prediction

---

# Management under uncertainty?

## Sequential Decision Problems

---


# Management under uncertainty: A Fisheries Example

---

# Consequences of Stochasticity & Imperfect Information

- Reed
- Clark
- Sethi
- POMDP


---

# Adaptive Management / Reinforcement Learning

--- 
Notes:

_Epistemic uncertainty limits our ability to describe, understand, predict, and manage the spatio-temporal dynamics of ecological systems.  Crucially, complex distributions underlie ecological processes at all levels of organization.  Why and how does variation arise and propagate (in space, time, among individuals) and how much variation do we expect? A deeper understanding of ecological variation will help to identify the limits and the uncertainties of ecological predictions.  How can information theoretic approaches be used effectively to glean knowledge from noisy and limited data?_

- See figures from noise phenomena paper and nimbios talk

